pipeline {
    agent any

    tools {
        maven 'maven' 
    }

    stages {
        stage('Checkout Code') {
            steps {
                // Tailored to your specific project repository
                git branch: 'main', url: 'https://github.com/LegitScarf/spring-petclinic-k8'
            }
        }
        
        stage('Build') {
            steps {
                sh 'mvn clean'
            }
        }
        
        stage('Test') {
            steps {
                sh 'mvn test'
            }
        }
        
        stage('SonarQube Analysis') {
            environment {
                // Replace with your actual EC2 Private/Public IP if it changed
                SONAR_HOST_URL = 'http://18.143.91.90:9000/' 
                // This 'sonarqube' ID must match the ID of the Secret Text credential you created in Jenkins
                SONAR_AUTH_TOKEN = credentials('sonar-token') 
            }
            steps {
                withSonarQubeEnv('sonarqube') {
                    // We use the full plugin name to avoid the 'prefix' error we saw earlier
                    sh "mvn org.sonarsource.scanner.maven:sonar-maven-plugin:3.9.1.2184:sonar \
                        -Dsonar.projectKey=spring-petclinic-k8 \
                        -Dsonar.host.url=${SONAR_HOST_URL} \
                        -Dsonar.login=${SONAR_AUTH_TOKEN}"
                }
            }
        }

        stage('Package') {
            steps {
                sh 'mvn package -DskipTests'
            }
        }
    }

    post {
        success {
            mail to: 'arpanmallik173@gmail.com',
            subject: 'Jenkins-SonarQube Integration Successful !!',
            body: "The build and analysis were successful.\n\nJob: ${env.JOB_NAME}\nBuild Number: ${env.BUILD_NUMBER}"
        }
    }
}



[09:41, 17/01/2026] Srinjoy Capg: docker run --name sonarqube-custom -p 9000:9000 sonarqube:community
[09:42, 17/01/2026] Srinjoy Capg: sudo docker ps -a
[09:42, 17/01/2026] Srinjoy Capg: sudo docker ps
[09:42, 17/01/2026] Srinjoy Capg: sudo docker start sonarqube-custom



